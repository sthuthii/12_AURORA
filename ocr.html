let currentStream;
let videoDevices = [];
let currentDeviceIndex = 0;

// Function to initialize camera with a selected device
async function startCamera(deviceId = null) {
  if (currentStream) {
    currentStream.getTracks().forEach(track => track.stop()); // Stop previous stream
  }

  const constraints = {
    video: deviceId ? { deviceId: { exact: deviceId } } : true
  };

  try {
    currentStream = await navigator.mediaDevices.getUserMedia(constraints);
    camera.srcObject = currentStream;
  } catch (err) {
    console.error("Error accessing camera:", err);
  }
}

// Function to get available video devices
async function getCameras() {
  try {
    const devices = await navigator.mediaDevices.enumerateDevices();
    videoDevices = devices.filter(device => device.kind === 'videoinput');
  } catch (err) {
    console.error("Error getting cameras:", err);
  }
}

// Switch camera function
async function switchCamera() {
  if (videoDevices.length > 1) {
    currentDeviceIndex = (currentDeviceIndex + 1) % videoDevices.length;
    await startCamera(videoDevices[currentDeviceIndex].deviceId);
  }
}

// Initialize cameras on page load
(async function () {
  await getCameras();
  await startCamera(videoDevices.length ? videoDevices[currentDeviceIndex].deviceId : null);
})();
